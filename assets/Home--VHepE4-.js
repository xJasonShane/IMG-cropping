import{j as e,r as a,k as t,a as l,c as r,b as s,n as o,w as n,l as i,m as u,t as c,p as d,q as v,s as g,v as m,u as p,F as h,x as y,y as b,z as x,o as f,A as k,d as w,B as C}from"./vendor-DU4NWb6H.js";import{g as M,r as R}from"./utils-BoXCEsRs.js";import{C as j}from"./cropper-BnGyONr1.js";const I=e("image",()=>{const e=a([]),l=a(null),r=a(null),s=a([{images:[],currentImageId:null}]),o=a(0),n=a(!1),i=t(()=>o.value>0),u=t(()=>o.value<s.value.length-1),c=()=>{if(n.value)return;const a={images:e.value.map(e=>({...e})),currentImageId:l.value?.id};o.value<s.value.length-1&&(s.value=s.value.slice(0,o.value+1)),s.value.push(a),o.value=s.value.length-1,s.value.length>50&&(s.value.shift(),o.value--)},d=()=>{const a=s.value[o.value];e.value=a.images.map(e=>({...e})),l.value=e.value.find(e=>e.id===a.currentImageId)};return{images:e,currentImage:l,cropperInstance:r,history:s,historyIndex:o,canUndo:i,canRedo:u,addImage:a=>{e.value.push(a),l.value=a,c()},setCurrentImage:e=>{l.value=e,c()},removeImage:a=>{const t=e.value.findIndex(e=>e.id===a);t>-1&&(e.value.splice(t,1),l.value?.id===a&&(l.value=e.value[0]||null),c())},setCropperInstance:e=>{r.value=e},undo:()=>{i.value&&(n.value=!0,o.value--,d(),setTimeout(()=>{n.value=!1},0))},redo:()=>{u.value&&(n.value=!0,o.value++,d(),setTimeout(()=>{n.value=!1},0))},clearHistory:()=>{s.value=[],o.value=-1}}}),U=e("settings",()=>{const e=a(1),t=a(1),l=a("free"),r=a({width:1,height:1}),s=a("png"),o=a(90),n=a("{original}_{index}"),i=a(null);return{gridRows:e,gridCols:t,aspectRatio:l,customAspectRatio:r,outputFormat:s,outputQuality:o,namingTemplate:n,presetTemplate:i,aspectRatios:[{label:"自由",value:"free"},{label:"1:1",value:"1:1"},{label:"4:3",value:"4:3"},{label:"16:9",value:"16:9"},{label:"3:2",value:"3:2"},{label:"5:4",value:"5:4"},{label:"自定义",value:"custom"}],presetTemplates:[{name:"社交媒体头像",width:400,height:400,aspectRatio:"1:1"},{name:"Instagram 正方形",width:1080,height:1080,aspectRatio:"1:1"},{name:"Instagram 竖版",width:1080,height:1350,aspectRatio:"4:5"},{name:"Instagram 横版",width:1080,height:608,aspectRatio:"16:9"},{name:"Twitter 头像",width:400,height:400,aspectRatio:"1:1"},{name:"Twitter 封面",width:1500,height:500,aspectRatio:"3:1"},{name:"YouTube 缩略图",width:1280,height:720,aspectRatio:"16:9"},{name:"证件照 (1寸)",width:295,height:413,aspectRatio:"25:35"},{name:"证件照 (2寸)",width:413,height:579,aspectRatio:"35:49"}],setGridRows:a=>{e.value=Math.max(1,Math.min(20,a))},setGridCols:e=>{t.value=Math.max(1,Math.min(20,e))},setAspectRatio:e=>{l.value=e},setCustomAspectRatio:(e,a)=>{r.value={width:e,height:a}},setOutputFormat:e=>{s.value=e},setOutputQuality:e=>{o.value=Math.max(10,Math.min(100,e))},setNamingTemplate:e=>{n.value=e},setPresetTemplate:e=>{i.value=e,e&&(l.value=e.aspectRatio)},generateFileName:(e,a)=>{const t=e.replace(/\.[^/.]+$/,"");return n.value.replace("{original}",t).replace("{index}",String(a+1).padStart(3,"0"))}}});const _=M(R()),z=(e,a,t,l={})=>{e.getImageData();const r=e.getCroppedCanvas();r.getContext("2d");const s=r.width/t,o=r.height/a,n=[];for(let i=0;i<a;i++)for(let e=0;e<t;e++){const a=document.createElement("canvas");a.width=s,a.height=o;a.getContext("2d").drawImage(r,e*s,i*o,s,o,0,0,s,o),n.push(a)}return n},B=async(e,a)=>{const t=new _;for(let l=0;l<e.length;l++){const r=e[l],s=a[l]||`image_${l+1}.png`,o=await new Promise(e=>{r.toBlob(a=>e(a),"image/png",.9)});t.file(s,o)}return await t.generateAsync({type:"blob"})},V=(e,a="cropped_images.zip")=>{const t=URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t)},L=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),P=e=>{if(!e)throw new Error("文件不存在");if(!["image/jpeg","image/png","image/webp"].includes(e.type))throw new Error("仅支持 JPG、PNG、WebP 格式的图片");if(e.size>52428800)throw new Error("图片大小不能超过 50MB");if(0===e.size)throw new Error("文件大小为 0，可能已损坏");return!0},$=e=>new Promise((a,t)=>{if(!e)return void t(new Error("文件不存在"));const l=new FileReader;l.onload=e=>{e.target.result?a(e.target.result):t(new Error("文件读取失败"))},l.onerror=e=>{t(new Error("文件读取失败，请检查文件是否损坏"))},l.onabort=()=>{t(new Error("文件读取被中断"))};try{l.readAsDataURL(e)}catch(r){t(new Error("文件读取失败"))}}),T=e=>{if("free"===e)return NaN;const[a,t]=e.split(":").map(Number);return a/t},E=e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["Bytes","KB","MB","GB"][a]},H={class:"flex flex-col items-center space-y-4"},A={__name:"ImageUpload",emits:["upload"],setup(e,{emit:t}){const i=t,u=I(),c=a(null),d=a(!1),v=a(!1),g=()=>{d.value=!0},m=()=>{d.value=!1},p=async e=>{d.value=!1;const a=Array.from(e.dataTransfer.files);await x(a)},h=()=>{v.value||c.value?.click()},y=async e=>{const a=Array.from(e.target.files);await x(a),e.target.value=""},b=e=>{const a=document.createElement("div");a.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-pulse",a.textContent=e,document.body.appendChild(a),setTimeout(()=>{document.body.removeChild(a)},3e3)},x=async e=>{if(v.value)return;const a=e.filter(e=>e.type.startsWith("image/"));if(0!==a.length){v.value=!0;for(const e of a)try{P(e);const a=await $(e);if(!a||"data:,"===a)throw new Error("文件读取失败，请重试");const t={id:L(),name:e.name,size:e.size,type:e.type,dataUrl:a,rotation:0,scaleX:1,scaleY:1,filters:{brightness:100,contrast:100,saturation:100}};u.addImage(t),i("upload",t)}catch(t){b(`${e.name}: ${t.message}`)}v.value=!1}else b("请选择有效的图片文件（JPG、PNG、WebP）")};return(e,a)=>(l(),r("div",{class:o(["upload-zone border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center transition-all duration-300 scale-in",{"border-primary-500 bg-primary-50 dark:bg-primary-900/20 transform scale-105":d.value,"hover:border-primary-400 hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-lg":!d.value}]),onDragover:n(g,["prevent"]),onDragleave:n(m,["prevent"]),onDrop:n(p,["prevent"]),onClick:h},[s("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/jpeg,image/png,image/webp",multiple:"",class:"hidden",onChange:y},null,544),s("div",H,[s("div",{class:o(["w-16 h-16 rounded-full bg-primary-100 dark:bg-primary-900/50 flex items-center justify-center transition-transform duration-300",{"scale-110":d.value}])},[...a[0]||(a[0]=[s("svg",{class:"w-8 h-8 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],2),a[1]||(a[1]=s("div",null,[s("p",{class:"text-lg font-medium text-gray-700 dark:text-gray-300"}," 拖放图片到这里或点击上传 "),s("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," 支持 JPG、PNG、WebP 格式，单张最大 50MB ")],-1)),a[2]||(a[2]=s("button",{class:"btn-primary"}," 选择图片 ",-1))])],34))}},F={class:"cropper-container"},N={key:0,class:"flex flex-col items-center justify-center h-full text-gray-500"},G={key:1,class:"flex flex-col items-center justify-center h-full text-red-500"},O={class:"text-sm text-center px-4"},D=["src","alt"],S={key:3,class:"flex flex-col items-center justify-center h-full text-gray-500"},Y=((e,a)=>{const t=e.__vccOpts||e;for(const[l,r]of a)t[l]=r;return t})({__name:"ImageCropper",props:{image:{type:Object,required:!0},height:{type:String,default:"500px"}},emits:["crop","ready"],setup(e,{expose:t,emit:o}){const n=e,g=o,m=I(),p=U(),h=a(null),y=a(null),b=a(!1),x=a(null),f=()=>{b.value=!1,x.value=null,C()},k=e=>{b.value=!1,x.value="图片加载失败，请检查文件格式或大小"},w=()=>{n.image&&n.image.dataUrl&&(x.value=null,b.value=!0)},C=()=>{if(h.value&&h.value.complete){y.value&&(y.value.destroy(),y.value=null);try{y.value=new j(h.value,{aspectRatio:T(p.aspectRatio),viewMode:1,dragMode:"move",autoCropArea:.8,restore:!1,guides:!0,center:!0,highlight:!1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!1,background:!1,ready:()=>{m.setCropperInstance(y.value),g("ready",y.value)},crop:()=>{g("crop",y.value)}})}catch(e){x.value="图片预览初始化失败，请刷新页面重试"}}},M=()=>{y.value&&y.value.zoom(.1)},R=()=>{y.value&&y.value.zoom(-.1)},_=()=>{y.value&&(y.value.rotate(-90),n.image.rotation=(n.image.rotation-90)%360)},z=()=>{y.value&&(y.value.rotate(90),n.image.rotation=(n.image.rotation+90)%360)},B=()=>{if(y.value){const e=y.value.getData();y.value.scaleX(-e.scaleX||-1),n.image.scaleX=-1*(n.image.scaleX||1)}},V=()=>{if(y.value){const e=y.value.getData();y.value.scaleY(-e.scaleY||-1),n.image.scaleY=-1*(n.image.scaleY||1)}},L=()=>{y.value&&(y.value.reset(),n.image.rotation=0,n.image.scaleX=1,n.image.scaleY=1)};return i(()=>p.aspectRatio,()=>{y.value&&y.value.setAspectRatio(T(p.aspectRatio))}),i(()=>n.image,(e,a)=>{e&&e.id!==a?.id&&(x.value=null,b.value=!0,v(()=>{h.value&&h.value.complete&&(b.value=!1,C())}))},{deep:!0}),u(()=>{y.value&&(y.value.destroy(),y.value=null)}),t({cropper:y,zoomIn:M,zoomOut:R,rotateLeft:_,rotateRight:z,flipHorizontal:B,flipVertical:V,reset:L}),(a,t)=>(l(),r("div",F,[s("div",{class:"relative bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden",style:d({height:e.height})},[b.value?(l(),r("div",N,[...t[0]||(t[0]=[s("div",{class:"loading-spinner mb-4"},null,-1),s("span",{class:"text-sm"},"加载图片中...",-1)])])):x.value?(l(),r("div",G,[t[1]||(t[1]=s("svg",{class:"w-12 h-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s("span",O,c(x.value),1),s("button",{onClick:w,class:"mt-4 btn-primary text-sm px-4 py-2"}," 重试 ")])):e.image&&e.image.dataUrl?(l(),r("img",{key:2,ref_key:"imageRef",ref:h,src:e.image.dataUrl,alt:e.image.name,class:"max-w-full",onLoad:f,onError:k},null,40,D)):(l(),r("div",S,[...t[2]||(t[2]=[s("svg",{class:"w-12 h-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),s("span",{class:"text-sm"},"请选择图片进行预览",-1)])]))],4),s("div",{class:"flex items-center justify-center space-x-4 mt-4"},[s("button",{onClick:M,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"放大"},[...t[3]||(t[3]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})],-1)])]),s("button",{onClick:R,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"缩小"},[...t[4]||(t[4]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})],-1)])]),t[10]||(t[10]=s("div",{class:"w-px h-6 bg-gray-300 dark:bg-gray-600"},null,-1)),s("button",{onClick:_,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"向左旋转"},[...t[5]||(t[5]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)])]),s("button",{onClick:z,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"向右旋转"},[...t[6]||(t[6]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})],-1)])]),t[11]||(t[11]=s("div",{class:"w-px h-6 bg-gray-300 dark:bg-gray-600"},null,-1)),s("button",{onClick:B,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"水平翻转"},[...t[7]||(t[7]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)])]),s("button",{onClick:V,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"垂直翻转"},[...t[8]||(t[8]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})],-1)])]),t[12]||(t[12]=s("div",{class:"w-px h-6 bg-gray-300 dark:bg-gray-600"},null,-1)),s("button",{onClick:L,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"重置"},[...t[9]||(t[9]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])])]))}},[["__scopeId","data-v-6e13706e"]]),Q={class:"settings-panel space-y-6"},q={class:"card"},W={class:"grid grid-cols-2 gap-4"},X={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},J={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},K={class:"card"},Z={class:"space-y-4"},ee=["value"],ae={key:0,class:"grid grid-cols-2 gap-4"},te=["value"],le={class:"card"},re={class:"space-y-4"},se={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},oe={class:"card"},ne={class:"space-y-4"},ie={class:"flex flex-wrap gap-2"},ue=["onClick"],ce={__name:"SettingsPanel",setup(e){const a=U(),o=t({get:()=>a.gridRows,set:e=>a.setGridRows(e)}),n=t({get:()=>a.gridCols,set:e=>a.setGridCols(e)}),i=t({get:()=>a.aspectRatio,set:e=>a.setAspectRatio(e)}),u=t({get:()=>a.customAspectRatio,set:e=>a.setCustomAspectRatio(e.width,e.height)}),d=t({get:()=>a.outputFormat,set:e=>a.setOutputFormat(e)}),v=t({get:()=>a.outputQuality,set:e=>a.setOutputQuality(e)}),x=t({get:()=>a.namingTemplate,set:e=>a.setNamingTemplate(e)}),f=t(()=>a.aspectRatios),k=t(()=>a.presetTemplates),w=t({get:()=>a.presetTemplate,set:e=>a.setPresetTemplate(e)}),C=["{original}_{index}","{original}_cropped_{index}","crop_{index}","img_{index}","{original}"];return(e,a)=>(l(),r("div",Q,[s("div",q,[a[9]||(a[9]=s("h3",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},"裁剪网格",-1)),s("div",W,[s("div",null,[s("label",X," 行数: "+c(o.value),1),g(s("input",{type:"range","onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),min:"1",max:"20",class:"w-full"},null,512),[[m,o.value,void 0,{number:!0}]])]),s("div",null,[s("label",J," 列数: "+c(n.value),1),g(s("input",{type:"range","onUpdate:modelValue":a[1]||(a[1]=e=>n.value=e),min:"1",max:"20",class:"w-full"},null,512),[[m,n.value,void 0,{number:!0}]])])])]),s("div",K,[a[15]||(a[15]=s("h3",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},"比例设置",-1)),s("div",Z,[s("div",null,[a[10]||(a[10]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 预设比例 ",-1)),g(s("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>i.value=e),class:"input-field"},[(l(!0),r(h,null,y(f.value,e=>(l(),r("option",{key:e.value,value:e.value},c(e.label),9,ee))),128))],512),[[p,i.value]])]),"custom"===i.value?(l(),r("div",ae,[s("div",null,[a[11]||(a[11]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 宽度 ",-1)),g(s("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=e=>u.value.width=e),min:"1",class:"input-field"},null,512),[[m,u.value.width,void 0,{number:!0}]])]),s("div",null,[a[12]||(a[12]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 高度 ",-1)),g(s("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=e=>u.value.height=e),min:"1",class:"input-field"},null,512),[[m,u.value.height,void 0,{number:!0}]])])])):b("",!0),s("div",null,[a[14]||(a[14]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 预设模板 ",-1)),g(s("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>w.value=e),class:"input-field"},[a[13]||(a[13]=s("option",{value:null},"无",-1)),(l(!0),r(h,null,y(k.value,e=>(l(),r("option",{key:e.name,value:e},c(e.name)+" ("+c(e.aspectRatio)+") ",9,te))),128))],512),[[p,w.value]])])])]),s("div",le,[a[18]||(a[18]=s("h3",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},"输出设置",-1)),s("div",re,[s("div",null,[a[17]||(a[17]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 输出格式 ",-1)),g(s("select",{"onUpdate:modelValue":a[6]||(a[6]=e=>d.value=e),class:"input-field"},[...a[16]||(a[16]=[s("option",{value:"png"},"PNG",-1),s("option",{value:"jpeg"},"JPG",-1),s("option",{value:"webp"},"WebP",-1)])],512),[[p,d.value]])]),s("div",null,[s("label",se," 质量: "+c(v.value)+"% ",1),g(s("input",{type:"range","onUpdate:modelValue":a[7]||(a[7]=e=>v.value=e),min:"10",max:"100",class:"w-full"},null,512),[[m,v.value,void 0,{number:!0}]])])])]),s("div",oe,[a[21]||(a[21]=s("h3",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},"命名规则",-1)),s("div",ne,[s("div",null,[a[19]||(a[19]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 命名模板 ",-1)),g(s("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>x.value=e),type:"text",class:"input-field",placeholder:"{original}_{index}"},null,512),[[m,x.value]]),a[20]||(a[20]=s("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"}," 可用变量: {original} - 原文件名, {index} - 序号 ",-1))]),s("div",ie,[(l(),r(h,null,y(C,e=>s("button",{key:e,onClick:a=>x.value=e,class:"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"},c(e),9,ue)),64))])])])]))}},de={class:"filters-panel space-y-4"},ve={class:"space-y-4"},ge={class:"flex justify-between mb-2"},me={class:"text-sm text-gray-500 dark:text-gray-400"},pe={class:"flex justify-between mb-2"},he={class:"text-sm text-gray-500 dark:text-gray-400"},ye={class:"flex justify-between mb-2"},be={class:"text-sm text-gray-500 dark:text-gray-400"},xe={class:"flex justify-between mb-2"},fe={class:"text-sm text-gray-500 dark:text-gray-400"},ke={class:"flex justify-between mb-2"},we={class:"text-sm text-gray-500 dark:text-gray-400"},Ce={class:"flex flex-wrap gap-2"},Me={__name:"FiltersPanel",props:{cropper:{type:Object,default:null}},setup(e){const o=e,n=I(),u=a({brightness:100,contrast:100,saturation:100,grayscale:0,blur:0}),d=t(()=>`brightness(${u.value.brightness}%) contrast(${u.value.contrast}%) saturate(${u.value.saturation}%) grayscale(${u.value.grayscale}%) blur(${u.value.blur}px)`),v=()=>{if(!o.cropper)return;const e=o.cropper.container;if(e){const a=e.querySelector(".cropper-canvas img");a&&(a.style.filter=d.value)}const a=n.currentImage;a&&(a.filters={...u.value})},p=()=>{u.value={brightness:100,contrast:100,saturation:100,grayscale:0,blur:0},v()},h=e=>{switch(e){case"vintage":u.value={brightness:110,contrast:90,saturation:80,grayscale:20,blur:0};break;case"bw":u.value={brightness:100,contrast:120,saturation:0,grayscale:100,blur:0};break;case"warm":u.value={brightness:105,contrast:95,saturation:120,grayscale:0,blur:0};break;case"cool":u.value={brightness:100,contrast:110,saturation:90,grayscale:0,blur:0}}v()};return i(()=>n.currentImage,e=>{e&&e.filters?u.value={...e.filters}:p()},{immediate:!0}),i(()=>o.cropper,e=>{e&&v()}),(e,a)=>(l(),r("div",de,[a[14]||(a[14]=s("h3",{class:"text-lg font-semibold text-gray-800 dark:text-white"},"图片滤镜",-1)),s("div",ve,[s("div",null,[s("div",ge,[a[9]||(a[9]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 亮度 ",-1)),s("span",me,c(u.value.brightness)+"%",1)]),g(s("input",{type:"range","onUpdate:modelValue":a[0]||(a[0]=e=>u.value.brightness=e),min:"0",max:"200",class:"w-full",onInput:v},null,544),[[m,u.value.brightness,void 0,{number:!0}]])]),s("div",null,[s("div",pe,[a[10]||(a[10]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 对比度 ",-1)),s("span",he,c(u.value.contrast)+"%",1)]),g(s("input",{type:"range","onUpdate:modelValue":a[1]||(a[1]=e=>u.value.contrast=e),min:"0",max:"200",class:"w-full",onInput:v},null,544),[[m,u.value.contrast,void 0,{number:!0}]])]),s("div",null,[s("div",ye,[a[11]||(a[11]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 饱和度 ",-1)),s("span",be,c(u.value.saturation)+"%",1)]),g(s("input",{type:"range","onUpdate:modelValue":a[2]||(a[2]=e=>u.value.saturation=e),min:"0",max:"200",class:"w-full",onInput:v},null,544),[[m,u.value.saturation,void 0,{number:!0}]])]),s("div",null,[s("div",xe,[a[12]||(a[12]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 灰度 ",-1)),s("span",fe,c(u.value.grayscale)+"%",1)]),g(s("input",{type:"range","onUpdate:modelValue":a[3]||(a[3]=e=>u.value.grayscale=e),min:"0",max:"100",class:"w-full",onInput:v},null,544),[[m,u.value.grayscale,void 0,{number:!0}]])]),s("div",null,[s("div",ke,[a[13]||(a[13]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 模糊 ",-1)),s("span",we,c(u.value.blur)+"px",1)]),g(s("input",{type:"range","onUpdate:modelValue":a[4]||(a[4]=e=>u.value.blur=e),min:"0",max:"10",step:"0.5",class:"w-full",onInput:v},null,544),[[m,u.value.blur,void 0,{number:!0}]])])]),s("div",Ce,[s("button",{onClick:p,class:"flex-1 btn-secondary text-sm"}," 重置 "),s("button",{onClick:a[5]||(a[5]=e=>h("vintage")),class:"flex-1 btn-primary text-sm"}," 复古 "),s("button",{onClick:a[6]||(a[6]=e=>h("bw")),class:"flex-1 btn-primary text-sm"}," 黑白 "),s("button",{onClick:a[7]||(a[7]=e=>h("warm")),class:"flex-1 btn-primary text-sm"}," 暖色 "),s("button",{onClick:a[8]||(a[8]=e=>h("cool")),class:"flex-1 btn-primary text-sm"}," 冷色 ")])]))}},Re={class:"image-list"},je={key:0,class:"text-center text-gray-500 dark:text-gray-400 py-8"},Ie={key:1,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"},Ue=["onClick"],_e=["src","alt"],ze={class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center"},Be=["onClick"],Ve={class:"mt-2"},Le=["title"],Pe={class:"text-xs text-gray-500 dark:text-gray-400"},$e={__name:"ImageList",setup(e){const a=I(),i=t(()=>a.images),u=t(()=>a.currentImage);return(e,t)=>(l(),r("div",Re,[0===i.value.length?(l(),r("div",je," 暂无图片，请上传 ")):(l(),r("div",Ie,[(l(!0),r(h,null,y(i.value,e=>(l(),r("div",{key:e.id,class:"relative group cursor-pointer",onClick:t=>(e=>{a.setCurrentImage(e)})(e)},[s("div",{class:o(["aspect-square rounded-lg overflow-hidden border-2 transition-all",{"border-primary-500 ring-2 ring-primary-500":u.value?.id===e.id,"border-gray-200 dark:border-gray-700":u.value?.id!==e.id}])},[s("img",{src:e.dataUrl,alt:e.name,class:"w-full h-full object-cover"},null,8,_e)],2),s("div",ze,[s("button",{onClick:n(t=>{return l=e.id,void(confirm("确定要删除这张图片吗？")&&a.removeImage(l));var l},["stop"]),class:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",title:"删除"},[...t[0]||(t[0]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Be)]),s("div",Ve,[s("p",{class:"text-sm text-gray-700 dark:text-gray-300 truncate",title:e.name},c(e.name),9,Le),s("p",Pe,c(x(E)(e.size)),1)])],8,Ue))),128))]))]))}},Te={class:"home"},Ee={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},He={class:"lg:col-span-2 space-y-6"},Ae={key:0,class:"card"},Fe={class:"flex items-center justify-between mb-4"},Ne={class:"text-lg font-semibold text-gray-800 dark:text-white"},Ge={class:"flex space-x-2"},Oe=["disabled"],De=["disabled"],Se={class:"mt-6 flex flex-wrap gap-4"},Ye=["disabled"],Qe={class:"space-y-6"},qe={key:1,class:"card"},We={class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},Xe={key:0,class:"fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-pulse"},Je={__name:"Home",setup(e){const o=I(),n=U(),i=a(null),u=a(!1),d=a(0),v=a(!1),g=a(""),m=t(()=>o.currentImage),p=t(()=>o.images),h=t(()=>o.canUndo),y=t(()=>o.canRedo),x=t(()=>n.gridRows),M=t(()=>n.gridCols),R=e=>{j(`${e.name} 上传成功`)},j=e=>{g.value=e,v.value=!0,setTimeout(()=>{v.value=!1},2e3)},L=()=>{o.undo()},P=()=>{o.redo()},$=async()=>{if(i.value?.cropper)try{const e=((e,a={})=>{const{format:t="image/png",quality:l=.9,width:r,height:s}=a;return e.getCroppedCanvas({imageSmoothingEnabled:!0,imageSmoothingQuality:"high",maxWidth:r,maxHeight:s})})(i.value.cropper,{format:`image/${n.outputFormat}`,quality:n.outputQuality/100}),a=await((e,a="image/png",t=.9)=>new Promise(l=>{e.toBlob(e=>{l(e)},a,t)}))(e,`image/${n.outputFormat}`,n.outputQuality/100);((e,a)=>{const t=URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t)})(a,`${n.generateFileName(m.value.name,0)}.${n.outputFormat}`),j("图片下载成功")}catch(e){j("裁剪失败，请重试")}},T=async()=>{if(i.value?.cropper)try{u.value=!0,d.value=0;const e=z(i.value.cropper,x.value,M.value);d.value=50;const a=e.map((e,a)=>n.generateFileName(m.value.name,a)),t=await B(e,a);V(t,`${m.value.name.replace(/\.[^/.]+$/,"")}_grid.zip`),d.value=100,j(`成功裁剪 ${e.length} 张图片`)}catch(e){j("网格裁剪失败，请重试")}finally{u.value=!1,d.value=0}},E=async()=>{if(0!==p.value.length)try{u.value=!0,d.value=0;const e=[],a=[],t=p.value.length;for(let l=0;l<p.value.length;l++){const r=p.value[l];if(o.setCurrentImage(r),await new Promise(e=>setTimeout(e,100)),i.value?.cropper){const t=z(i.value.cropper,x.value,M.value),l=t.map((e,a)=>n.generateFileName(r.name,a));e.push(...t),a.push(...l)}d.value=Math.round((l+1)/t*100)}if(e.length>0){const t=await B(e,a);V(t,"all_cropped_images.zip"),j(`成功处理 ${e.length} 张图片`)}}catch(e){j("批量处理失败，请重试")}finally{u.value=!1,d.value=0}},H=async()=>{if(0!==p.value.length)try{u.value=!0,d.value=0;const e=new _,a=p.value.length;for(let l=0;l<p.value.length;l++){const t=p.value[l],r=await fetch(t.dataUrl),s=await r.blob(),o=t.name;e.file(o,s),d.value=Math.round((l+1)/a*100)}const t=await e.generateAsync({type:"blob"});V(t,"all_original_images.zip"),j(`成功导出 ${p.value.length} 张原图`)}catch(e){j("导出失败，请重试")}finally{u.value=!1,d.value=0}},F=e=>{(e.ctrlKey||e.metaKey)&&("z"===e.key?(e.preventDefault(),L()):"y"===e.key&&(e.preventDefault(),P()))};return f(()=>{window.addEventListener("keydown",F)}),k(()=>{window.removeEventListener("keydown",F)}),(e,a)=>(l(),r("div",Te,[a[6]||(a[6]=s("div",{class:"mb-8"},[s("h2",{class:"text-3xl font-bold text-gray-800 dark:text-white mb-2"}," 图片裁剪工具 "),s("p",{class:"text-gray-600 dark:text-gray-400"}," 上传图片，设置参数，一键裁剪并下载 ")],-1)),s("div",Ee,[s("div",He,[w(A,{onUpload:R}),m.value?(l(),r("div",Ae,[s("div",Fe,[s("h3",Ne,c(m.value.name),1),s("div",Ge,[s("button",{onClick:L,disabled:!h.value,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"撤销 (Ctrl+Z)"},[...a[0]||(a[0]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)])],8,Oe),s("button",{onClick:P,disabled:!y.value,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"重做 (Ctrl+Y)"},[...a[1]||(a[1]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})],-1)])],8,De)])]),(l(),C(Y,{ref_key:"cropperRef",ref:i,image:m.value,key:m.value?.id},null,8,["image"])),s("div",Se,[s("button",{onClick:$,class:"btn-primary flex items-center space-x-2"},[...a[2]||(a[2]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),s("span",null,"下载当前裁剪",-1)])]),s("button",{onClick:T,class:"btn-primary flex items-center space-x-2"},[a[3]||(a[3]=s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)),s("span",null,"裁剪网格 ("+c(x.value)+"x"+c(M.value)+")",1)]),s("button",{onClick:E,disabled:u.value,class:"btn-secondary flex items-center space-x-2"},[a[4]||(a[4]=s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1)),s("span",null,c(u.value?`处理中 ${d.value}%`:"批量裁剪所有图片"),1)],8,Ye),p.value.length>1?(l(),r("button",{key:0,onClick:H,class:"btn-secondary flex items-center space-x-2"},[...a[5]||(a[5]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),s("span",null,"导出所有原图",-1)])])):b("",!0)])])):b("",!0)]),s("div",Qe,[w(ce),m.value?(l(),C(Me,{key:0,cropper:i.value?.cropper},null,8,["cropper"])):b("",!0),p.value.length>0?(l(),r("div",qe,[s("h3",We," 图片列表 ("+c(p.value.length)+") ",1),w($e)])):b("",!0)])]),v.value?(l(),r("div",Xe,c(g.value),1)):b("",!0)]))}};export{Je as default};
