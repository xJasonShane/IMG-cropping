import{j as e,r as a,k as t,a as l,c as r,b as s,n as o,w as n,l as i,m as u,p as c,q as d,t as g,s as m,v as p,u as v,F as h,x as y,y as b,z as x,d as f,A as k}from"./vendor-CqZ6ImrL.js";import{g as w,r as C}from"./utils-BoXCEsRs.js";import{C as R}from"./cropper-BnGyONr1.js";const M=e("image",()=>{const e=a([]),l=a(null),r=a(null),s=a([{images:[],currentImageId:null}]),o=a(0),n=a(!1),i=t(()=>o.value>0),u=t(()=>o.value<s.value.length-1),c=()=>{if(n.value)return;const a={images:e.value.map(e=>({...e})),currentImageId:l.value?.id};o.value<s.value.length-1&&(s.value=s.value.slice(0,o.value+1)),s.value.push(a),o.value=s.value.length-1,s.value.length>50&&(s.value.shift(),o.value--)},d=()=>{const a=s.value[o.value];e.value=a.images.map(e=>({...e})),l.value=e.value.find(e=>e.id===a.currentImageId)};return{images:e,currentImage:l,cropperInstance:r,history:s,historyIndex:o,canUndo:i,canRedo:u,addImage:a=>{e.value.push(a),l.value=a,c()},setCurrentImage:e=>{l.value=e,c()},removeImage:a=>{const t=e.value.findIndex(e=>e.id===a);t>-1&&(e.value.splice(t,1),l.value?.id===a&&(l.value=e.value[0]||null),c())},setCropperInstance:e=>{r.value=e},undo:()=>{i.value&&(n.value=!0,o.value--,d(),setTimeout(()=>{n.value=!1},0))},redo:()=>{u.value&&(n.value=!0,o.value++,d(),setTimeout(()=>{n.value=!1},0))},clearHistory:()=>{s.value=[],o.value=-1}}}),I=e("settings",()=>{const e=a(1),t=a(1),l=a("free"),r=a({width:1,height:1}),s=a("png"),o=a(90),n=a("{original}_{index}"),i=a(null);return{gridRows:e,gridCols:t,aspectRatio:l,customAspectRatio:r,outputFormat:s,outputQuality:o,namingTemplate:n,presetTemplate:i,aspectRatios:[{label:"自由",value:"free"},{label:"1:1",value:"1:1"},{label:"4:3",value:"4:3"},{label:"16:9",value:"16:9"},{label:"3:2",value:"3:2"},{label:"5:4",value:"5:4"},{label:"自定义",value:"custom"}],presetTemplates:[{name:"社交媒体头像",width:400,height:400,aspectRatio:"1:1"},{name:"Instagram 正方形",width:1080,height:1080,aspectRatio:"1:1"},{name:"Instagram 竖版",width:1080,height:1350,aspectRatio:"4:5"},{name:"Instagram 横版",width:1080,height:608,aspectRatio:"16:9"},{name:"Twitter 头像",width:400,height:400,aspectRatio:"1:1"},{name:"Twitter 封面",width:1500,height:500,aspectRatio:"3:1"},{name:"YouTube 缩略图",width:1280,height:720,aspectRatio:"16:9"},{name:"证件照 (1寸)",width:295,height:413,aspectRatio:"25:35"},{name:"证件照 (2寸)",width:413,height:579,aspectRatio:"35:49"}],setGridRows:a=>{e.value=Math.max(1,Math.min(20,a))},setGridCols:e=>{t.value=Math.max(1,Math.min(20,e))},setAspectRatio:e=>{l.value=e},setCustomAspectRatio:(e,a)=>{r.value={width:e,height:a}},setOutputFormat:e=>{s.value=e},setOutputQuality:e=>{o.value=Math.max(10,Math.min(100,e))},setNamingTemplate:e=>{n.value=e},setPresetTemplate:e=>{i.value=e,e&&(l.value=e.aspectRatio)},generateFileName:(e,a)=>{const t=e.replace(/\.[^/.]+$/,"");return n.value.replace("{original}",t).replace("{index}",String(a+1).padStart(3,"0"))}}});const j=w(C()),U=(e,a,t,l={})=>{e.getImageData();const r=e.getCroppedCanvas();r.getContext("2d");const s=r.width/t,o=r.height/a,n=[];for(let i=0;i<a;i++)for(let e=0;e<t;e++){const a=document.createElement("canvas");a.width=s,a.height=o;a.getContext("2d").drawImage(r,e*s,i*o,s,o,0,0,s,o),n.push(a)}return n},_=async(e,a)=>{const t=new j;for(let l=0;l<e.length;l++){const r=e[l],s=a[l]||`image_${l+1}.png`,o=await new Promise(e=>{r.toBlob(a=>e(a),"image/png",.9)});t.file(s,o)}return await t.generateAsync({type:"blob"})},V=(e,a="cropped_images.zip")=>{const t=URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t)},B=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),P=e=>{if(!["image/jpeg","image/png","image/webp"].includes(e.type))throw new Error("仅支持 JPG、PNG、WebP 格式的图片");if(e.size>52428800)throw new Error("图片大小不能超过 50MB");return!0},T=e=>new Promise((a,t)=>{const l=new FileReader;l.onload=e=>a(e.target.result),l.onerror=e=>t(e),l.readAsDataURL(e)}),z=e=>{if("free"===e)return NaN;const[a,t]=e.split(":").map(Number);return a/t},L=e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["Bytes","KB","MB","GB"][a]},A={class:"flex flex-col items-center space-y-4"},$={__name:"ImageUpload",emits:["upload"],setup(e,{emit:t}){const i=t,u=M(),c=a(null),d=a(!1),g=()=>{d.value=!0},m=()=>{d.value=!1},p=async e=>{d.value=!1;const a=Array.from(e.dataTransfer.files);await y(a)},v=()=>{c.value?.click()},h=async e=>{const a=Array.from(e.target.files);await y(a),e.target.value=""},y=async e=>{const a=e.filter(e=>e.type.startsWith("image/"));if(0!==a.length)for(const l of a)try{P(l);const e=await T(l),a={id:B(),name:l.name,size:l.size,type:l.type,dataUrl:e,rotation:0,scaleX:1,scaleY:1,filters:{brightness:100,contrast:100,saturation:100}};u.addImage(a),i("upload",a)}catch(t){alert(`${l.name}: ${t.message}`)}else alert("请选择有效的图片文件")};return(e,a)=>(l(),r("div",{class:o(["upload-zone border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center transition-all duration-300 scale-in",{"border-primary-500 bg-primary-50 dark:bg-primary-900/20 transform scale-105":d.value,"hover:border-primary-400 hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-lg":!d.value}]),onDragover:n(g,["prevent"]),onDragleave:n(m,["prevent"]),onDrop:n(p,["prevent"]),onClick:v},[s("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/jpeg,image/png,image/webp",multiple:"",class:"hidden",onChange:h},null,544),s("div",A,[s("div",{class:o(["w-16 h-16 rounded-full bg-primary-100 dark:bg-primary-900/50 flex items-center justify-center transition-transform duration-300",{"scale-110":d.value}])},[...a[0]||(a[0]=[s("svg",{class:"w-8 h-8 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],2),a[1]||(a[1]=s("div",null,[s("p",{class:"text-lg font-medium text-gray-700 dark:text-gray-300"}," 拖放图片到这里或点击上传 "),s("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," 支持 JPG、PNG、WebP 格式，单张最大 50MB ")],-1)),a[2]||(a[2]=s("button",{class:"btn-primary"}," 选择图片 ",-1))])],34))}},F={class:"cropper-container"},H=["src","alt"],D={key:1,class:"flex items-center justify-center h-full text-gray-500"},N=((e,a)=>{const t=e.__vccOpts||e;for(const[l,r]of a)t[l]=r;return t})({__name:"ImageCropper",props:{image:{type:Object,required:!0},height:{type:String,default:"500px"}},emits:["crop","ready"],setup(e,{expose:t,emit:o}){const n=e,g=o,m=M(),p=I(),v=a(null),h=a(null),y=()=>{v.value&&(h.value&&(h.value.destroy(),h.value=null),h.value=new R(v.value,{aspectRatio:z(p.aspectRatio),viewMode:1,dragMode:"move",autoCropArea:.8,restore:!1,guides:!0,center:!0,highlight:!1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!1,background:!1,ready:()=>{m.setCropperInstance(h.value),g("ready",h.value)},crop:()=>{g("crop",h.value)}}))},b=()=>{h.value&&(h.value.rotate(-90),n.image.rotation=(n.image.rotation-90)%360)},x=()=>{h.value&&(h.value.rotate(90),n.image.rotation=(n.image.rotation+90)%360)},f=()=>{if(h.value){const e=h.value.getData();h.value.scaleX(-e.scaleX||-1),n.image.scaleX=-1*(n.image.scaleX||1)}},k=()=>{if(h.value){const e=h.value.getData();h.value.scaleY(-e.scaleY||-1),n.image.scaleY=-1*(n.image.scaleY||1)}},w=()=>{h.value&&(h.value.reset(),n.image.rotation=0,n.image.scaleX=1,n.image.scaleY=1)};return i(()=>p.aspectRatio,()=>{h.value&&h.value.setAspectRatio(z(p.aspectRatio))}),i(()=>n.image,()=>{d(()=>{v.value&&y()})},{deep:!0}),u(()=>{h.value&&(h.value.destroy(),h.value=null)}),t({cropper:h,rotateLeft:b,rotateRight:x,flipHorizontal:f,flipVertical:k,reset:w}),(a,t)=>(l(),r("div",F,[s("div",{class:"relative bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden",style:c({height:e.height})},[e.image&&e.image.dataUrl?(l(),r("img",{key:0,ref_key:"imageRef",ref:v,src:e.image.dataUrl,alt:e.image.name,class:"max-w-full",onLoad:y},null,40,H)):(l(),r("div",D,[...t[0]||(t[0]=[s("span",null,"加载图片中...",-1)])]))],4),s("div",{class:"flex items-center justify-center space-x-4 mt-4"},[s("button",{onClick:b,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"向左旋转"},[...t[1]||(t[1]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)])]),s("button",{onClick:x,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"向右旋转"},[...t[2]||(t[2]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})],-1)])]),s("button",{onClick:f,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"水平翻转"},[...t[3]||(t[3]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)])]),s("button",{onClick:k,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"垂直翻转"},[...t[4]||(t[4]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})],-1)])]),s("button",{onClick:w,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"重置"},[...t[5]||(t[5]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])])]))}},[["__scopeId","data-v-1bdb9073"]]),O={class:"settings-panel space-y-6"},G={class:"card"},S={class:"grid grid-cols-2 gap-4"},Q={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},Y={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},E={class:"card"},X={class:"space-y-4"},q=["value"],W={key:0,class:"grid grid-cols-2 gap-4"},J=["value"],K={class:"card"},Z={class:"space-y-4"},ee={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},ae={class:"card"},te={class:"space-y-4"},le={class:"flex flex-wrap gap-2"},re=["onClick"],se={__name:"SettingsPanel",setup(e){const a=I(),o=t({get:()=>a.gridRows,set:e=>a.setGridRows(e)}),n=t({get:()=>a.gridCols,set:e=>a.setGridCols(e)}),i=t({get:()=>a.aspectRatio,set:e=>a.setAspectRatio(e)}),u=t({get:()=>a.customAspectRatio,set:e=>a.setCustomAspectRatio(e.width,e.height)}),c=t({get:()=>a.outputFormat,set:e=>a.setOutputFormat(e)}),d=t({get:()=>a.outputQuality,set:e=>a.setOutputQuality(e)}),x=t({get:()=>a.namingTemplate,set:e=>a.setNamingTemplate(e)}),f=t(()=>a.aspectRatios),k=t(()=>a.presetTemplates),w=t({get:()=>a.presetTemplate,set:e=>a.setPresetTemplate(e)}),C=["{original}_{index}","{original}_cropped_{index}","crop_{index}","img_{index}","{original}"];return(e,a)=>(l(),r("div",O,[s("div",G,[a[9]||(a[9]=s("h3",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},"裁剪网格",-1)),s("div",S,[s("div",null,[s("label",Q," 行数: "+g(o.value),1),m(s("input",{type:"range","onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),min:"1",max:"20",class:"w-full"},null,512),[[p,o.value,void 0,{number:!0}]])]),s("div",null,[s("label",Y," 列数: "+g(n.value),1),m(s("input",{type:"range","onUpdate:modelValue":a[1]||(a[1]=e=>n.value=e),min:"1",max:"20",class:"w-full"},null,512),[[p,n.value,void 0,{number:!0}]])])])]),s("div",E,[a[15]||(a[15]=s("h3",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},"比例设置",-1)),s("div",X,[s("div",null,[a[10]||(a[10]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 预设比例 ",-1)),m(s("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>i.value=e),class:"input-field"},[(l(!0),r(h,null,y(f.value,e=>(l(),r("option",{key:e.value,value:e.value},g(e.label),9,q))),128))],512),[[v,i.value]])]),"custom"===i.value?(l(),r("div",W,[s("div",null,[a[11]||(a[11]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 宽度 ",-1)),m(s("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=e=>u.value.width=e),min:"1",class:"input-field"},null,512),[[p,u.value.width,void 0,{number:!0}]])]),s("div",null,[a[12]||(a[12]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 高度 ",-1)),m(s("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=e=>u.value.height=e),min:"1",class:"input-field"},null,512),[[p,u.value.height,void 0,{number:!0}]])])])):b("",!0),s("div",null,[a[14]||(a[14]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 预设模板 ",-1)),m(s("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>w.value=e),class:"input-field"},[a[13]||(a[13]=s("option",{value:null},"无",-1)),(l(!0),r(h,null,y(k.value,e=>(l(),r("option",{key:e.name,value:e},g(e.name)+" ("+g(e.aspectRatio)+") ",9,J))),128))],512),[[v,w.value]])])])]),s("div",K,[a[18]||(a[18]=s("h3",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},"输出设置",-1)),s("div",Z,[s("div",null,[a[17]||(a[17]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 输出格式 ",-1)),m(s("select",{"onUpdate:modelValue":a[6]||(a[6]=e=>c.value=e),class:"input-field"},[...a[16]||(a[16]=[s("option",{value:"png"},"PNG",-1),s("option",{value:"jpeg"},"JPG",-1),s("option",{value:"webp"},"WebP",-1)])],512),[[v,c.value]])]),s("div",null,[s("label",ee," 质量: "+g(d.value)+"% ",1),m(s("input",{type:"range","onUpdate:modelValue":a[7]||(a[7]=e=>d.value=e),min:"10",max:"100",class:"w-full"},null,512),[[p,d.value,void 0,{number:!0}]])])])]),s("div",ae,[a[21]||(a[21]=s("h3",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},"命名规则",-1)),s("div",te,[s("div",null,[a[19]||(a[19]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 命名模板 ",-1)),m(s("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>x.value=e),type:"text",class:"input-field",placeholder:"{original}_{index}"},null,512),[[p,x.value]]),a[20]||(a[20]=s("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"}," 可用变量: {original} - 原文件名, {index} - 序号 ",-1))]),s("div",le,[(l(),r(h,null,y(C,e=>s("button",{key:e,onClick:a=>x.value=e,class:"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"},g(e),9,re)),64))])])])]))}},oe={class:"filters-panel space-y-4"},ne={class:"space-y-4"},ie={class:"flex justify-between mb-2"},ue={class:"text-sm text-gray-500 dark:text-gray-400"},ce={class:"flex justify-between mb-2"},de={class:"text-sm text-gray-500 dark:text-gray-400"},ge={class:"flex justify-between mb-2"},me={class:"text-sm text-gray-500 dark:text-gray-400"},pe={class:"flex justify-between mb-2"},ve={class:"text-sm text-gray-500 dark:text-gray-400"},he={class:"flex justify-between mb-2"},ye={class:"text-sm text-gray-500 dark:text-gray-400"},be={class:"flex space-x-2"},xe={__name:"FiltersPanel",props:{cropper:{type:Object,default:null}},setup(e){const t=e,o=M(),n=a({brightness:100,contrast:100,saturation:100,grayscale:0,blur:0}),u=()=>{if(!t.cropper)return;const e=t.cropper.getCroppedCanvas(),a=e.getContext("2d");a.filter=`brightness(${n.value.brightness}%) contrast(${n.value.contrast}%) saturate(${n.value.saturation}%) grayscale(${n.value.grayscale}%) blur(${n.value.blur}px)`;const l=a.getImageData(0,0,e.width,e.height);a.putImageData(l,0,0);const r=o.currentImage;r&&(r.filters={...n.value})},c=()=>{n.value={brightness:100,contrast:100,saturation:100,grayscale:0,blur:0},u()},d=e=>{switch(e){case"vintage":n.value={brightness:110,contrast:90,saturation:80,grayscale:20,blur:0};break;case"bw":n.value={brightness:100,contrast:120,saturation:0,grayscale:100,blur:0}}u()};return i(()=>o.currentImage,e=>{e&&e.filters?n.value={...e.filters}:c()}),(e,a)=>(l(),r("div",oe,[a[12]||(a[12]=s("h3",{class:"text-lg font-semibold text-gray-800 dark:text-white"},"图片滤镜",-1)),s("div",ne,[s("div",null,[s("div",ie,[a[7]||(a[7]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 亮度 ",-1)),s("span",ue,g(n.value.brightness)+"%",1)]),m(s("input",{type:"range","onUpdate:modelValue":a[0]||(a[0]=e=>n.value.brightness=e),min:"0",max:"200",class:"w-full",onInput:u},null,544),[[p,n.value.brightness,void 0,{number:!0}]])]),s("div",null,[s("div",ce,[a[8]||(a[8]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 对比度 ",-1)),s("span",de,g(n.value.contrast)+"%",1)]),m(s("input",{type:"range","onUpdate:modelValue":a[1]||(a[1]=e=>n.value.contrast=e),min:"0",max:"200",class:"w-full",onInput:u},null,544),[[p,n.value.contrast,void 0,{number:!0}]])]),s("div",null,[s("div",ge,[a[9]||(a[9]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 饱和度 ",-1)),s("span",me,g(n.value.saturation)+"%",1)]),m(s("input",{type:"range","onUpdate:modelValue":a[2]||(a[2]=e=>n.value.saturation=e),min:"0",max:"200",class:"w-full",onInput:u},null,544),[[p,n.value.saturation,void 0,{number:!0}]])]),s("div",null,[s("div",pe,[a[10]||(a[10]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 灰度 ",-1)),s("span",ve,g(n.value.grayscale)+"%",1)]),m(s("input",{type:"range","onUpdate:modelValue":a[3]||(a[3]=e=>n.value.grayscale=e),min:"0",max:"100",class:"w-full",onInput:u},null,544),[[p,n.value.grayscale,void 0,{number:!0}]])]),s("div",null,[s("div",he,[a[11]||(a[11]=s("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 模糊 ",-1)),s("span",ye,g(n.value.blur)+"px",1)]),m(s("input",{type:"range","onUpdate:modelValue":a[4]||(a[4]=e=>n.value.blur=e),min:"0",max:"10",step:"0.5",class:"w-full",onInput:u},null,544),[[p,n.value.blur,void 0,{number:!0}]])])]),s("div",be,[s("button",{onClick:c,class:"flex-1 btn-secondary"}," 重置滤镜 "),s("button",{onClick:a[5]||(a[5]=e=>d("vintage")),class:"flex-1 btn-primary"}," 复古 "),s("button",{onClick:a[6]||(a[6]=e=>d("bw")),class:"flex-1 btn-primary"}," 黑白 ")])]))}},fe={class:"image-list"},ke={key:0,class:"text-center text-gray-500 dark:text-gray-400 py-8"},we={key:1,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"},Ce=["onClick"],Re=["src","alt"],Me={class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center"},Ie=["onClick"],je={class:"mt-2"},Ue=["title"],_e={class:"text-xs text-gray-500 dark:text-gray-400"},Ve={__name:"ImageList",setup(e){const a=M(),i=t(()=>a.images),u=t(()=>a.currentImage);return(e,t)=>(l(),r("div",fe,[0===i.value.length?(l(),r("div",ke," 暂无图片，请上传 ")):(l(),r("div",we,[(l(!0),r(h,null,y(i.value,e=>(l(),r("div",{key:e.id,class:"relative group cursor-pointer",onClick:t=>(e=>{a.setCurrentImage(e)})(e)},[s("div",{class:o(["aspect-square rounded-lg overflow-hidden border-2 transition-all",{"border-primary-500 ring-2 ring-primary-500":u.value?.id===e.id,"border-gray-200 dark:border-gray-700":u.value?.id!==e.id}])},[s("img",{src:e.dataUrl,alt:e.name,class:"w-full h-full object-cover"},null,8,Re)],2),s("div",Me,[s("button",{onClick:n(t=>{return l=e.id,void(confirm("确定要删除这张图片吗？")&&a.removeImage(l));var l},["stop"]),class:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",title:"删除"},[...t[0]||(t[0]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ie)]),s("div",je,[s("p",{class:"text-sm text-gray-700 dark:text-gray-300 truncate",title:e.name},g(e.name),9,Ue),s("p",_e,g(x(L)(e.size)),1)])],8,Ce))),128))]))]))}},Be={class:"home"},Pe={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Te={class:"lg:col-span-2 space-y-6"},ze={key:0,class:"card"},Le={class:"flex items-center justify-between mb-4"},Ae={class:"text-lg font-semibold text-gray-800 dark:text-white"},$e={class:"flex space-x-2"},Fe=["disabled"],He=["disabled"],De={class:"mt-6 flex flex-wrap gap-4"},Ne={class:"space-y-6"},Oe={key:1,class:"card"},Ge={class:"text-lg font-semibold mb-4 text-gray-800 dark:text-white"},Se={__name:"Home",setup(e){const o=M(),n=I(),i=a(null),u=t(()=>o.currentImage),c=t(()=>o.images),d=t(()=>o.canUndo),m=t(()=>o.canRedo),p=t(()=>n.gridRows),v=t(()=>n.gridCols),h=e=>{},y=()=>{o.undo()},x=()=>{o.redo()},w=async()=>{if(!i.value?.cropper)return;const e=((e,a={})=>{const{format:t="image/png",quality:l=.9,width:r,height:s}=a;return e.getCroppedCanvas({imageSmoothingEnabled:!0,imageSmoothingQuality:"high",maxWidth:r,maxHeight:s})})(i.value.cropper,{format:`image/${n.outputFormat}`,quality:n.outputQuality/100}),a=await((e,a="image/png",t=.9)=>new Promise(l=>{e.toBlob(e=>{l(e)},a,t)}))(e,`image/${n.outputFormat}`,n.outputQuality/100);((e,a)=>{const t=URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t)})(a,`${n.generateFileName(u.value.name,0)}.${n.outputFormat}`)},C=async()=>{if(!i.value?.cropper)return;const e=U(i.value.cropper,p.value,v.value),a=e.map((e,a)=>n.generateFileName(u.value.name,a)),t=await _(e,a);V(t,`${u.value.name.replace(/\.[^/.]+$/,"")}_grid.zip`)},R=async()=>{if(0===c.value.length)return;const e=[],a=[];for(const t of c.value)if(o.setCurrentImage(t),await new Promise(e=>setTimeout(e,100)),i.value?.cropper){const l=U(i.value.cropper,p.value,v.value),r=l.map((e,a)=>n.generateFileName(t.name,a));e.push(...l),a.push(...r)}if(e.length>0){const t=await _(e,a);V(t,"all_cropped_images.zip")}};return(e,a)=>(l(),r("div",Be,[a[5]||(a[5]=s("div",{class:"mb-8"},[s("h2",{class:"text-3xl font-bold text-gray-800 dark:text-white mb-2"}," 图片裁剪工具 "),s("p",{class:"text-gray-600 dark:text-gray-400"}," 上传图片，设置参数，一键裁剪并下载 ")],-1)),s("div",Pe,[s("div",Te,[f($,{onUpload:h}),u.value?(l(),r("div",ze,[s("div",Le,[s("h3",Ae,g(u.value.name),1),s("div",$e,[s("button",{onClick:y,disabled:!d.value,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"撤销"},[...a[0]||(a[0]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)])],8,Fe),s("button",{onClick:x,disabled:!m.value,class:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"重做"},[...a[1]||(a[1]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})],-1)])],8,He)])]),(l(),k(N,{ref_key:"cropperRef",ref:i,image:u.value,key:u.value?.id},null,8,["image"])),s("div",De,[s("button",{onClick:w,class:"btn-primary flex items-center space-x-2"},[...a[2]||(a[2]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),s("span",null,"下载当前裁剪",-1)])]),s("button",{onClick:C,class:"btn-primary flex items-center space-x-2"},[a[3]||(a[3]=s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)),s("span",null,"裁剪网格 ("+g(p.value)+"x"+g(v.value)+")",1)]),s("button",{onClick:R,class:"btn-secondary flex items-center space-x-2"},[...a[4]||(a[4]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1),s("span",null,"批量裁剪所有图片",-1)])])])])):b("",!0)]),s("div",Ne,[f(se),u.value?(l(),k(xe,{key:0,cropper:i.value?.cropper},null,8,["cropper"])):b("",!0),c.value.length>0?(l(),r("div",Oe,[s("h3",Ge," 图片列表 ("+g(c.value.length)+") ",1),f(Ve)])):b("",!0)])])]))}};export{Se as default};
